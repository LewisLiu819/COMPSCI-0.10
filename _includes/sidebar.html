<div class="sidebar">
  <a href="{{ '/' | relative_url }}" class="brand">
    COMPSCI 0.10
  </a>

  <div class="nav-list">
    {% assign current_lang = page.lang | default: "zh" %}
    {% assign all_pages = site.pages | sort: "nav_order" %}
    
    {% comment %} Filter pages for current language {% endcomment %}
    {% assign lang_pages = "" | split: "" %}
    {% for p in all_pages %}
      {% if p.lang == current_lang and p.title and p.nav_exclude != true %}
         {% assign lang_pages = lang_pages | push: p %}
      {% endif %}
    {% endfor %}

    <ul>
      <li>
        <a href="{{ '/' | relative_url }}" {% if page.url == "/" %}class="active"{% endif %}>
          {% if current_lang == "en" %}Home{% else %}首页{% endif %}
        </a>
      </li>
      
      {% comment %} Render Top Level Items (no parent) {% endcomment %}
      {% for p in lang_pages %}
        {% unless p.parent %}
          <li>
            <a href="{{ p.url | relative_url }}" {% if p.url == page.url %}class="active"{% endif %}>
              {{ p.title }}
            </a>
            
            {% comment %} Render Level 2 Children {% endcomment %}
            {% if p.has_children %}
              <ul class="nav-children">
                {% for child in lang_pages %}
                  {% if child.parent == p.title %}
                    <li>
                      <a href="{{ child.url | relative_url }}" {% if child.url == page.url %}class="active"{% endif %}>
                        {{ child.title }}
                      </a>
                      
                      {% comment %} Render Level 3 Children (Lessons) {% endcomment %}
                      {% if child.has_children %}
                        <ul class="nav-grandchildren">
                          {% for grandchild in lang_pages %}
                            {% if grandchild.parent == child.title %}
                              <li>
                                <a href="{{ grandchild.url | relative_url }}" {% if grandchild.url == page.url %}class="active"{% endif %}>
                                  {{ grandchild.title }}
                                </a>
                              </li>
                            {% endif %}
                          {% endfor %}
                        </ul>
                      {% endif %}
                    </li>
                  {% endif %}
                {% endfor %}
              </ul>
            {% endif %}
          </li>
        {% endunless %}
      {% endfor %}
    </ul>
  </div>
</div>
