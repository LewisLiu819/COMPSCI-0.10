<div class="sidebar">
  <a href="{{ '/' | relative_url }}" class="brand">
    COMPSCI 0.10
  </a>

  <div class="nav-list">
    {% assign current_lang = page.lang | default: "zh" %}
    {% assign pages = site.pages | sort: "nav_order" %}
    
    <ul>
      <li>
        <a href="{{ '/' | relative_url }}" {% if page.url == "/" %}class="active"{% endif %}>
          {% if current_lang == "en" %}Home{% else %}首页{% endif %}
        </a>
      </li>
      
      {% comment %} Filter pages for current language {% endcomment %}
      {% assign lang_pages = "" | split: "" %}
      {% for p in pages %}
        {% if p.lang == current_lang and p.title and p.nav_exclude != true %}
           {% assign lang_pages = lang_pages | push: p %}
        {% endif %}
      {% endfor %}

      {% comment %} Render Top Level Items {% endcomment %}
      {% for p in lang_pages %}
        {% unless p.parent %}
          <li>
            <a href="{{ p.url | relative_url }}" {% if p.url == page.url %}class="active"{% endif %}>
              {{ p.title }}
            </a>
            
            {% comment %} Render Children (1 level deep for simplicity) {% endcomment %}
            {% if p.has_children %}
              <ul style="padding-left: 1rem; list-style: none;">
                {% for child in lang_pages %}
                  {% if child.parent == p.title %}
                    <li>
                      <a href="{{ child.url | relative_url }}" {% if child.url == page.url %}class="active"{% endif %} style="font-size: 0.9em;">
                        {{ child.title }}
                      </a>
                    </li>
                  {% endif %}
                {% endfor %}
              </ul>
            {% endif %}
          </li>
        {% endunless %}
      {% endfor %}
    </ul>
  </div>
</div>

