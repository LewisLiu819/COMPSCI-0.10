<!-- Navigation Enhancement JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Add active state to current page
  const currentPath = window.location.pathname;
  const navLinks = document.querySelectorAll('.nav-list-link');

  navLinks.forEach(link => {
    if (link.getAttribute('href') === currentPath) {
      link.classList.add('active');
    }
  });

  // Add loading state on navigation clicks
  navLinks.forEach(link => {
    link.addEventListener('click', function() {
      this.classList.add('loading');
    });
  });

  // Add keyboard navigation support
  navLinks.forEach((link, index) => {
    link.addEventListener('keydown', function(e) {
      if (e.key === 'ArrowDown' && navLinks[index + 1]) {
        e.preventDefault();
        navLinks[index + 1].focus();
      } else if (e.key === 'ArrowUp' && navLinks[index - 1]) {
        e.preventDefault();
        navLinks[index - 1].focus();
      }
    });
  });

  // Add fun click effects
  navLinks.forEach(link => {
    link.addEventListener('click', function(e) {
      // Create ripple effect
      const ripple = document.createElement('span');
      ripple.style.position = 'absolute';
      ripple.style.borderRadius = '50%';
      ripple.style.background = 'rgba(255,255,255,0.6)';
      ripple.style.transform = 'scale(0)';
      ripple.style.animation = 'ripple 0.6s linear';

      // Calculate position relative to the clicked element
      const rect = this.getBoundingClientRect();
      const x = e.clientX - rect.left - 10;
      const y = e.clientY - rect.top - 10;

      ripple.style.left = x + 'px';
      ripple.style.top = y + 'px';
      ripple.style.width = '20px';
      ripple.style.height = '20px';
      ripple.style.pointerEvents = 'none';

      this.appendChild(ripple);

      setTimeout(() => {
        if (ripple.parentNode) {
          ripple.remove();
        }
      }, 600);
    });
  });

  // Add progress indicator to sidebar if it doesn't exist
  const sideNav = document.querySelector('.site-nav');
  if (sideNav && !sideNav.querySelector('.nav-progress')) {
    const progressDiv = document.createElement('div');
    progressDiv.className = 'nav-progress';
    progressDiv.title = 'Course Progress';
    sideNav.insertBefore(progressDiv, sideNav.firstChild);
  }

  // Update progress based on current lesson
  updateProgressIndicator();

  function updateProgressIndicator() {
    const progressBar = document.querySelector('.nav-progress::after') ||
                       document.querySelector('.nav-progress');

    if (progressBar) {
      // Extract lesson number from current path
      const lessonMatch = currentPath.match(/lesson(\d+)/);
      if (lessonMatch) {
        const lessonNumber = parseInt(lessonMatch[1]);
        const progressPercentage = (lessonNumber / 15) * 100;

        // Create or update CSS custom property for progress
        document.documentElement.style.setProperty('--progress-width', progressPercentage + '%');
      }
    }
  }

  // Add smooth scrolling to navigation links
  navLinks.forEach(link => {
    link.addEventListener('click', function(e) {
      // Only apply smooth scroll for same-page links
      if (this.getAttribute('href').startsWith('#')) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      }
    });
  });

  // Add visual feedback for lesson completion
  // This would normally be connected to a backend system
  // For demo purposes, we'll use localStorage
  updateLessonCompletionStatus();

  function updateLessonCompletionStatus() {
    // Check localStorage for completed lessons
    const completedLessons = JSON.parse(localStorage.getItem('completedLessons') || '[]');

    navLinks.forEach(link => {
      const href = link.getAttribute('href');
      const lessonMatch = href.match(/lesson(\d+)/);

      if (lessonMatch) {
        const lessonNumber = parseInt(lessonMatch[1]);
        if (completedLessons.includes(lessonNumber)) {
          link.classList.add('completed');
          // Add checkmark to completed lessons
          if (!link.querySelector('.completion-check')) {
            const checkmark = document.createElement('span');
            checkmark.className = 'completion-check';
            checkmark.innerHTML = ' âœ“';
            checkmark.style.color = '#4CAF50';
            checkmark.style.fontWeight = 'bold';
            link.appendChild(checkmark);
          }
        }
      }
    });
  }

  // Function to mark current lesson as completed (called when lesson is finished)
  window.markLessonCompleted = function(lessonNumber) {
    const completedLessons = JSON.parse(localStorage.getItem('completedLessons') || '[]');
    if (!completedLessons.includes(lessonNumber)) {
      completedLessons.push(lessonNumber);
      localStorage.setItem('completedLessons', JSON.stringify(completedLessons));
      updateLessonCompletionStatus();
      updateProgressIndicator();
    }
  };
});

// Add dynamic CSS for progress bar
const progressStyle = document.createElement('style');
progressStyle.textContent = `
  .nav-progress::after {
    width: var(--progress-width, 30%) !important;
  }

  .nav-list-link.completed {
    background: linear-gradient(135deg, #4CAF50 0%, #66BB6A 100%) !important;
    color: white !important;
  }

  .nav-list-link.loading::after {
    content: '';
    position: absolute;
    top: 50%;
    right: 1rem;
    width: 20px;
    height: 20px;
    border: 2px solid transparent;
    border-top: 2px solid currentColor;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    transform: translateY(-50%);
  }

  @keyframes spin {
    to { transform: translateY(-50%) rotate(360deg); }
  }
`;
document.head.appendChild(progressStyle);
</script>