<!-- Previous/Next Lesson Navigation -->
{% assign current_url = page.url %}
{% assign lesson_number = current_url | split: 'lesson' | last | split: '/' | first | plus: 0 %}
{% assign lang = page.lang | default: 'zh' %}

<div class="lesson-navigation" style="margin: 3rem 0; padding: 2rem; background: linear-gradient(135deg, #f1f3f4 0%, #e8eaf6 100%); border-radius: 20px; box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);">

  <!-- Navigation Header -->
  <div style="text-align: center; margin-bottom: 2rem;">
    <h3 style="color: #2E86AB; margin-bottom: 0.5rem; font-size: 1.5rem;">
      {% if lang == 'en' %}ğŸš€ Continue Your Learning Journey!{% else %}ğŸš€ ç»§ç»­æ‚¨çš„å­¦ä¹ ä¹‹æ—…ï¼{% endif %}
    </h3>
    <p style="color: #666; font-size: 1rem; margin: 0;">
      {% if lang == 'en' %}Navigate between lessons to explore more computer science concepts{% else %}åœ¨è¯¾ç¨‹ä¹‹é—´å¯¼èˆªï¼Œæ¢ç´¢æ›´å¤šè®¡ç®—æœºç§‘å­¦æ¦‚å¿µ{% endif %}
    </p>
  </div>

  <!-- Navigation Buttons Container -->
  <div class="nav-buttons-container" style="display: flex; justify-content: space-between; align-items: center; gap: 2rem; flex-wrap: wrap;">

    <!-- Previous Lesson Button -->
    {% if lesson_number > 1 %}
      {% assign prev_lesson = lesson_number | minus: 1 %}
      {% assign prev_lesson_url = "/lessons/lesson" | append: prev_lesson | append: "/" %}
      {% if lang == 'en' %}
        {% assign prev_lesson_url = "/en" | append: prev_lesson_url %}
      {% endif %}

      <div class="nav-button-wrapper" style="flex: 1; max-width: 300px;">
        <a href="{{ prev_lesson_url }}" class="nav-button prev-button" style="display: flex; align-items: center; padding: 1.5rem; background: linear-gradient(135deg, #4CAF50 0%, #66BB6A 100%); color: white; text-decoration: none; border-radius: 16px; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3); position: relative; overflow: hidden;">

          <!-- Arrow Icon -->
          <div class="nav-icon" style="font-size: 2rem; margin-right: 1rem; transition: transform 0.3s ease;">â¬…ï¸</div>

          <!-- Button Content -->
          <div class="nav-content" style="text-align: left;">
            <div class="nav-label" style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 0.25rem;">
              {% if lang == 'en' %}Previous Lesson{% else %}ä¸Šä¸€è¯¾{% endif %}
            </div>
            <div class="nav-title" style="font-size: 1.1rem; line-height: 1.3;">
              {% if lang == 'en' %}Lesson {{ prev_lesson }}{% else %}ç¬¬{{ prev_lesson }}è¯¾{% endif %}
            </div>
          </div>

          <!-- Hover shine effect -->
          <div class="shine-effect" style="position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); transition: left 0.6s ease;"></div>
        </a>
      </div>
    {% else %}
      <!-- Placeholder for first lesson -->
      <div class="nav-button-wrapper" style="flex: 1; max-width: 300px;">
        <div class="nav-button disabled" style="display: flex; align-items: center; padding: 1.5rem; background: #E0E0E0; color: #999; border-radius: 16px; font-weight: 600; opacity: 0.6;">
          <div class="nav-icon" style="font-size: 2rem; margin-right: 1rem;">ğŸ</div>
          <div class="nav-content" style="text-align: left;">
            <div class="nav-label" style="font-size: 0.9rem; margin-bottom: 0.25rem;">
              {% if lang == 'en' %}You're at the start!{% else %}æ‚¨å·²ç»åœ¨èµ·ç‚¹äº†ï¼{% endif %}
            </div>
            <div class="nav-title" style="font-size: 1.1rem; line-height: 1.3;">
              {% if lang == 'en' %}First Lesson{% else %}ç¬¬ä¸€è¯¾{% endif %}
            </div>
          </div>
        </div>
      </div>
    {% endif %}

    <!-- Current Lesson Indicator -->
    <div class="current-lesson-indicator" style="text-align: center; padding: 1rem; background: linear-gradient(135deg, #F18F01 0%, #FF6B35 100%); color: white; border-radius: 50%; width: 80px; height: 80px; display: flex; align-items: center; justify-content: center; font-weight: bold; box-shadow: 0 4px 15px rgba(241, 143, 1, 0.4); position: relative;">
      <div style="text-align: center;">
        <div style="font-size: 1.5rem; line-height: 1;">{{ lesson_number }}</div>
        <div style="font-size: 0.7rem; opacity: 0.9;">
          {% if lang == 'en' %}Current{% else %}å½“å‰{% endif %}
        </div>
      </div>
      <!-- Pulsing ring animation -->
      <div class="pulse-ring" style="position: absolute; top: -5px; left: -5px; width: 90px; height: 90px; border: 3px solid rgba(241, 143, 1, 0.6); border-radius: 50%; animation: pulse-ring 2s infinite;"></div>
    </div>

    <!-- Next Lesson Button -->
    {% if lesson_number < 15 %}
      {% assign next_lesson = lesson_number | plus: 1 %}
      {% assign next_lesson_url = "/lessons/lesson" | append: next_lesson | append: "/" %}
      {% if lang == 'en' %}
        {% assign next_lesson_url = "/en" | append: next_lesson_url %}
      {% endif %}

      <div class="nav-button-wrapper" style="flex: 1; max-width: 300px;">
        <a href="{{ next_lesson_url }}" class="nav-button next-button" style="display: flex; align-items: center; padding: 1.5rem; background: linear-gradient(135deg, #2196F3 0%, #42A5F5 100%); color: white; text-decoration: none; border-radius: 16px; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3); position: relative; overflow: hidden; flex-direction: row-reverse;">

          <!-- Arrow Icon -->
          <div class="nav-icon" style="font-size: 2rem; margin-left: 1rem; transition: transform 0.3s ease;">â¡ï¸</div>

          <!-- Button Content -->
          <div class="nav-content" style="text-align: right;">
            <div class="nav-label" style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 0.25rem;">
              {% if lang == 'en' %}Next Lesson{% else %}ä¸‹ä¸€è¯¾{% endif %}
            </div>
            <div class="nav-title" style="font-size: 1.1rem; line-height: 1.3;">
              {% if lang == 'en' %}Lesson {{ next_lesson }}{% else %}ç¬¬{{ next_lesson }}è¯¾{% endif %}
            </div>
          </div>

          <!-- Hover shine effect -->
          <div class="shine-effect" style="position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); transition: left 0.6s ease;"></div>
        </a>
      </div>
    {% else %}
      <!-- Placeholder for last lesson -->
      <div class="nav-button-wrapper" style="flex: 1; max-width: 300px;">
        <div class="nav-button disabled" style="display: flex; align-items: center; padding: 1.5rem; background: linear-gradient(135deg, #9C27B0 0%, #BA68C8 100%); color: white; border-radius: 16px; font-weight: 600; flex-direction: row-reverse;">
          <div class="nav-icon" style="font-size: 2rem; margin-left: 1rem;">ğŸ‰</div>
          <div class="nav-content" style="text-align: right;">
            <div class="nav-label" style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 0.25rem;">
              {% if lang == 'en' %}Congratulations!{% else %}æ­å–œæ‚¨ï¼{% endif %}
            </div>
            <div class="nav-title" style="font-size: 1.1rem; line-height: 1.3;">
              {% if lang == 'en' %}Course Complete{% else %}è¯¾ç¨‹å®Œæˆ{% endif %}
            </div>
          </div>
        </div>
      </div>
    {% endif %}

  </div>

  <!-- Quick Jump Section -->
  <div class="quick-jump-section" style="margin-top: 2.5rem; padding-top: 2rem; border-top: 2px solid rgba(46, 134, 171, 0.1);">
    <div style="text-align: center; margin-bottom: 1.5rem;">
      <h4 style="color: #2E86AB; margin-bottom: 0.5rem; font-size: 1.2rem;">
        {% if lang == 'en' %}ğŸ“š Quick Jump to Any Lesson{% else %}ğŸ“š å¿«é€Ÿè·³è½¬åˆ°ä»»æ„è¯¾ç¨‹{% endif %}
      </h4>
    </div>

    <!-- Lesson Quick Navigation Grid -->
    <div class="quick-nav-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(50px, 1fr)); gap: 0.75rem; max-width: 600px; margin: 0 auto;">
      {% for i in (1..15) %}
        {% assign quick_lesson_url = "/lessons/lesson" | append: i | append: "/" %}
        {% if lang == 'en' %}
          {% assign quick_lesson_url = "/en" | append: quick_lesson_url %}
        {% endif %}

        {% assign is_current = false %}
        {% if i == lesson_number %}
          {% assign is_current = true %}
        {% endif %}

        <a href="{{ quick_lesson_url }}"
           class="quick-nav-item {% if is_current %}current{% endif %}"
           style="display: flex; align-items: center; justify-content: center; width: 50px; height: 50px; border-radius: 12px; text-decoration: none; font-weight: 600; font-size: 1rem; transition: all 0.3s ease; {% if is_current %}background: linear-gradient(135deg, #F18F01 0%, #FF6B35 100%); color: white; box-shadow: 0 4px 15px rgba(241, 143, 1, 0.4);{% else %}background: white; color: #2E86AB; border: 2px solid #E5E7EB;{% endif %}"
           title="{% if lang == 'en' %}Go to Lesson {{ i }}{% else %}è·³è½¬åˆ°ç¬¬{{ i }}è¯¾{% endif %}">
          {{ i }}
        </a>
      {% endfor %}
    </div>
  </div>

</div>

<!-- Navigation Styles and Animations -->
<style>
.nav-button:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2) !important;
}

.nav-button:hover .nav-icon {
  transform: scale(1.2);
}

.nav-button:hover .shine-effect {
  left: 100%;
}

.quick-nav-item:hover {
  transform: translateY(-2px) scale(1.1);
  background: linear-gradient(135deg, #2E86AB 0%, #A23B72 100%) !important;
  color: white !important;
  box-shadow: 0 6px 20px rgba(46, 134, 171, 0.3) !important;
}

.quick-nav-item.current {
  animation: gentle-pulse 2s infinite;
}

@keyframes pulse-ring {
  0% {
    transform: scale(1);
    opacity: 1;
  }
  100% {
    transform: scale(1.3);
    opacity: 0;
  }
}

@keyframes gentle-pulse {
  0%, 100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.05);
  }
}

/* Mobile responsiveness */
@media (max-width: 768px) {
  .nav-buttons-container {
    flex-direction: column !important;
    gap: 1.5rem !important;
  }

  .nav-button-wrapper {
    max-width: 100% !important;
    width: 100%;
  }

  .current-lesson-indicator {
    order: -1;
    width: 60px !important;
    height: 60px !important;
    margin: 0 auto;
  }

  .quick-nav-grid {
    grid-template-columns: repeat(5, 1fr) !important;
    gap: 0.5rem !important;
  }

  .quick-nav-item {
    width: 40px !important;
    height: 40px !important;
    font-size: 0.9rem !important;
  }

  .nav-button {
    padding: 1.25rem !important;
  }

  .nav-icon {
    font-size: 1.5rem !important;
  }
}

/* Accessibility improvements */
.nav-button:focus,
.quick-nav-item:focus {
  outline: 3px solid #F18F01;
  outline-offset: 2px;
}

/* Add loading animation for page transitions */
.nav-button.loading::after {
  content: '';
  position: absolute;
  top: 50%;
  right: 1rem;
  width: 20px;
  height: 20px;
  border: 2px solid transparent;
  border-top: 2px solid currentColor;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  transform: translateY(-50%);
}

@keyframes spin {
  to { transform: translateY(-50%) rotate(360deg); }
}
</style>

<!-- Navigation JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Add loading state to navigation buttons
  const navButtons = document.querySelectorAll('.nav-button:not(.disabled)');

  navButtons.forEach(button => {
    button.addEventListener('click', function(e) {
      this.classList.add('loading');
    });
  });

  // Add keyboard navigation for quick jump
  document.addEventListener('keydown', function(e) {
    // Allow Ctrl/Cmd + Number to jump to lessons
    if ((e.ctrlKey || e.metaKey) && e.key >= '1' && e.key <= '9') {
      e.preventDefault();
      const lessonNumber = parseInt(e.key);
      if (lessonNumber <= 15) {
        const lang = document.documentElement.lang || 'zh';
        const baseUrl = lang === 'en' ? '/en/lessons/lesson' : '/lessons/lesson';
        window.location.href = baseUrl + lessonNumber + '/';
      }
    }

    // Arrow key navigation between lessons
    const currentLessonNumber = {{ lesson_number }};

    if (e.key === 'ArrowLeft' && currentLessonNumber > 1) {
      e.preventDefault();
      const prevButton = document.querySelector('.prev-button');
      if (prevButton) {
        prevButton.click();
      }
    } else if (e.key === 'ArrowRight' && currentLessonNumber < 15) {
      e.preventDefault();
      const nextButton = document.querySelector('.next-button');
      if (nextButton) {
        nextButton.click();
      }
    }
  });

  // Add progress celebration for lesson completion
  window.celebrateProgressUpdate = function() {
    const currentIndicator = document.querySelector('.current-lesson-indicator');
    if (currentIndicator) {
      currentIndicator.style.animation = 'gentle-pulse 0.5s ease 3';

      // Add confetti effect
      const confetti = document.createElement('div');
      confetti.style.cssText = `
        position: absolute;
        top: -20px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 2rem;
        animation: confetti-fall 2s ease-out;
        pointer-events: none;
        z-index: 1000;
      `;
      confetti.textContent = 'ğŸ‰';

      currentIndicator.appendChild(confetti);

      setTimeout(() => {
        confetti.remove();
      }, 2000);
    }
  };

  // Add tooltip functionality for better UX
  const quickNavItems = document.querySelectorAll('.quick-nav-item');
  quickNavItems.forEach(item => {
    item.addEventListener('mouseenter', function() {
      if (!this.classList.contains('current')) {
        this.style.transform = 'translateY(-2px) scale(1.1)';
      }
    });

    item.addEventListener('mouseleave', function() {
      if (!this.classList.contains('current')) {
        this.style.transform = '';
      }
    });
  });
});

// Add confetti animation
const confettiStyle = document.createElement('style');
confettiStyle.textContent = `
  @keyframes confetti-fall {
    0% {
      opacity: 1;
      transform: translateX(-50%) translateY(0) rotate(0deg);
    }
    100% {
      opacity: 0;
      transform: translateX(-50%) translateY(-50px) rotate(360deg);
    }
  }
`;
document.head.appendChild(confettiStyle);
</script>